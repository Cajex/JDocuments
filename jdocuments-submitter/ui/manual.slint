import { Button, VerticalBox, ListView, HorizontalBox } from "std-widgets.slint";

export enum InsertMode {
    Latest,
    ByID
}

export component EntryComponents {
    in-out property <[[string]]> entries;
    in-out property <color> second_color;
    in-out property <string> primary_font;
    in-out property <color> accent_color;
    in-out property <brush> background;
    in-out property <int> position: 0;
    in-out property <[bool]> range: [false, false, false];
    callback change_title(string, string);

    function get_name(i: int) -> string {
        entries[i][0]
    }

    function get_id(i: int) -> string {
        entries[i][1]
    }

    VerticalLayout {
        spacing: 10px;
        for b[i] in range: Rectangle {
            width: parent.width - 40px;
            x: 0;
            height: 100px;
            border-color: root.second_color;
            border-width: 1px;
            border-radius: 6px;
            VerticalLayout {
                y: 10px;
                x: 10px;
                alignment: LayoutAlignment.start;
                spacing: 10px;
                HorizontalLayout {
                    alignment: LayoutAlignment.start;
                    Text {
                        font-size: 10px;
                        font-family: root.primary_font;
                        color: root.second_color;
                        text: "Document name: ";
                        width: 100px;
                    }
                    Text {
                        font-size: 10px;
                        font-family: root.primary_font;
                        color: root.accent_color;
                        text: get_name(i + position);
                        width: 140px;
                        wrap: TextWrap.no-wrap;
                    }
                }
                HorizontalLayout {
                    alignment: LayoutAlignment.start;
                    Text {
                        font-size: 10px;
                        font-family: root.primary_font;
                        color: root.second_color;
                        text: "Document ID: ";
                        width: 100px;
                    }
                    Text {
                        font-size: 10px;
                        font-family: root.primary_font;
                        color: root.accent_color;
                        text: get_id(i + position);
                    }
                }
                Rectangle {
                    edit_title_window:= PopupWindow {
                        x: ai.mouse-x + 220px;
                        close-policy: PopupClosePolicy.no-auto-close;
                        Rectangle {
                            border-width: 1px;
                            border-radius: 6px;
                            border-color: root.second_color;
                            width: 450px;
                            height: 25px;
                            background: root.background;
                            init => {
                                ti.focus();
                            }
                            ti:=TextInput {
                                horizontal-alignment: TextHorizontalAlignment.center;
                                vertical-alignment: TextVerticalAlignment.center;
                                text: get_name(i + position);
                                font-size: 10px;
                                font-family: root.primary_font;
                                color: root.second_color;
                                accepted => {
                                    edit_title_window.close();
                                    change_title(get_id(i + position), get_name(i + position));
                                }
                            }
                        }
                    }
                    border-width: 1px;
                    border-radius: 6px;
                    border-color: root.second_color;
                    height: 25px;
                    width: 120px;
                    HorizontalLayout {
                        y: 6px;
                        alignment: LayoutAlignment.center;
                        spacing: 10px;
                        Text {
                            text: "change title";
                            font-size: 10px;
                            font-family: root.primary_font;
                            color: root.second_color;
                        }
                        Image {
                            source: @image-url("resources/pen.png");
                            width: 14px;
                            height: 14px;
                        }
                    }
                    ai:=TouchArea {
                        clicked => {
                            edit_title_window.show();
                        }
                    }
                }
            }
        }
    }

}

export component SubmitterWindow inherits Window {
    width: 1024px;
    height: 512px;
    title: "Submitter";
    background: #242423;
    icon: @image-url("resources/icon.png");
    out property <color> second_color: #ccc5b9;
    out property <color> selection_background_color: #6c757d;
    out property <color> accent_color: #60d394;
    out property <string> primary_font: "Cascadia Code";
    in-out property <int> documents_inserted_counter;
    in-out property <int> links_inserted_counter;
    in-out property <int> tags_inserted_counter;
    in-out property <float> info_scroll_perc: 0;
    in-out property <[[string]]> entries;
    in-out property <int> position;

    callback document_title_accepted(string);
    callback document_author_accepted(string);
    callback document_origin_location_accepted(string);
    callback document_origin_date_accepted(string);
    callback document_links_accepted(string);
    callback document_tags_accepted(string);
    callback request_documents_len() -> int;
    callback request_links_len() -> int;
    callback request_tags_len() -> int;
    callback call_init_info();
    callback submit();
    callback insert_entries(InsertMode, string);
    callback change_title(string, string);

    function submit_formular() {
        title_input.text = "";
        author_input.text = "";
        location_input.text = "";
        tag_input.text = "";
        documents_inserted_counter = request_documents_len();
        links_inserted_counter = request_links_len();
        tags_inserted_counter = request_tags_len();
        submit();
    }
    function init_info() {
        documents_inserted_counter = request_documents_len();
        links_inserted_counter = request_links_len();
        tags_inserted_counter = request_tags_len();
    }

    HorizontalLayout {
        x: 0;
        y: 0;
        padding-top: 10px;
        padding-left: 10px;
        alignment: LayoutAlignment.start;
        HorizontalLayout {
            Text {
                font-size: 8px;
                font-family: root.primary_font;
                color: root.second_color;
                text: "Documents inserted: ";
            }
            Text {
                font-size: 8px;
                font-family: root.primary_font;
                color: root.accent_color;
                text: documents_inserted_counter;
            }
        }
        Text {
            font-size: 8px;
            font-family: root.primary_font;
            color: root.second_color;
            text: " | ";
        }
        HorizontalLayout {
            Text {
                font-size: 8px;
                font-family: root.primary_font;
                color: root.second_color;
                text: "Links inserted: ";
            }
            Text {
                font-size: 8px;
                font-family: root.primary_font;
                color: root.accent_color;
                text: links_inserted_counter;
            }
        }
        Text {
            font-size: 8px;
            font-family: root.primary_font;
            color: root.second_color;
            text: " | ";
        }
        HorizontalLayout {
            Text {
                font-size: 8px;
                font-family: root.primary_font;
                color: root.second_color;
                text: "Tags inserted: ";
            }
            Text {
                font-size: 8px;
                font-family: root.primary_font;
                color: root.accent_color;
                text: tags_inserted_counter;
            }
        }
    }

    VerticalLayout {
        width: root.width;
        height: root.height;
        alignment: LayoutAlignment.center;
        HorizontalLayout {
            alignment: LayoutAlignment.center;
            spacing: 30px;
            HorizontalLayout {
                spacing: 30px;
                Rectangle {
                    width: 300px;
                    TouchArea {
                        scroll-event(event) => {
                            if (event.delta-y != 0) {
                                if (event.delta-y > 0) {
                                    if (info_scroll_perc <= 95) {
                                       root.info_scroll_perc += 1;
                                       position+=1;
                                    }
                                } else {
                                    if (root.info_scroll_perc >= 0) {
                                        root.info_scroll_perc += -1;
                                        position -= 1
                                    }
                                }
                                EventResult.accept
                            }
                            EventResult.reject
                        }
                    }
                    Rectangle {
                        x: parent.width;
                        border-radius: 6px;
                        width: 1px;
                        background: root.second_color;
                        Rectangle {
                            y: parent.height * (info_scroll_perc / 100);
                            background: root.background;
                            width: 10px;
                            height: 25px;
                            border-radius: 6px;
                            border-color: root.accent_color;
                            border-width: 1px;
                        }
                    }
                    Rectangle {
                        HorizontalLayout {
                            spacing: 10px;
                            Rectangle {
                                y: 5px;
                                width: 220px;
                                height: 28px;
                                border-radius: 6px;
                                border-width: 1px;
                                border-color: root.second_color;
                                Image {
                                    x: 6px;
                                    source: @image-url("resources/search.png");
                                    width: 15px;
                                    height: 15px;
                                }
                                search_text:= Text {
                                    x: (parent.width / 2) - (self.width / 2);
                                    text: "search for id";
                                    font-family: root.primary_font;
                                    font-size: 10px;
                                    color: root.second_color;
                                    visible: true;
                                }
                                search_text_input:= TextInput {
                                    horizontal-alignment: TextHorizontalAlignment.center;
                                    vertical-alignment: TextVerticalAlignment.center;
                                    font-family: root.primary_font;
                                    color: root.second_color;
                                    input-type: InputType.number;
                                    selection-background-color: root.selection_background_color;
                                    edited => {
                                        search_text.visible = search_text_input.text.is-empty;
                                    }
                                    accepted => {
                                        insert_entries(InsertMode.ByID, search_text_input.text);
                                        search_text.visible = true;
                                        search_text_input.text = "";
                                    }
                                }
                            }
                            Rectangle {
                                y: 5px;
                                height: 28px;
                                width: 28px;
                                border-radius: 6px;
                                border-width: 1px;
                                border-color: root.second_color;
                                Image {
                                    source: @image-url("resources/clock.png");
                                    width: 13px;
                                    height: 13px;
                                }
                                TouchArea {
                                    clicked => {
                                        search_text_input.text = "";
                                        search_text.visible = true;
                                        insert_entries(InsertMode.Latest, "0");
                                    }
                                }
                            }
                        }

                        VerticalLayout {
                           y: 50px;
                            HorizontalLayout {
                                Text {
                                    text: "Documents found: ";
                                    font-size: 10px;
                                    font-family: root.primary_font;
                                    color: root.second_color;
                                    height: 20px;
                                    width: 100px;
                                }
                                Text {
                                    text: entries.length;
                                    font-size: 10px;
                                    font-family: root.primary_font;
                                    color: root.accent_color;
                                    height: 20px;
                                }
                            }

                            EntryComponents {
                                entries <=> root.entries;
                                second_color <=> root.second_color;
                                primary_font <=> root.primary_font;
                                accent_color <=> root.accent_color;
                                background <=> root.background;
                                position <=> root.position;
                                change_title(i1, i2) => {
                                    root.change_title(i1, i2);
                                }
                            }
                        }
                    }

                }
                HorizontalLayout {
                    height: 400px;
                    spacing: 30px;
                    HorizontalLayout {
                        Text {
                            font-family: primary_font;
                            font-size: 15px;
                            font-weight: 600;
                            height: 25px;
                            vertical-alignment: TextVerticalAlignment.center;
                            color: root.second_color;
                            text: "General";
                        }
                    }
                    dot0:=Rectangle {
                        background: root.second_color;
                        width: 1px;
                        Rectangle {
                            y: parent.y;
                            background: root.background;
                            border-radius: 30px;
                            border-color: root.second_color;
                            border-width: 1px;
                            width: 25px;
                            height: 25px;
                        }
                    }
                }
            }

            Rectangle {
                width: (root.width * 0.5);
                height: 400px;
                border-color: root.second_color;
                border-width: 1px;
                border-radius: 6px;
                VerticalLayout {
                    x: 20px;
                    width: parent.width;
                    height: parent.height;
                    alignment: LayoutAlignment.space-around;
                    HorizontalLayout {
                        Text {
                            vertical-alignment: TextVerticalAlignment.center;
                            color: root.second_color;
                            text: "Document Title";
                            font-family: primary_font;
                            font-size: 14px;
                            width: 150px;
                        }
                        init => {
                            title_input.focus();
                        }
                        Rectangle {
                            border-color: root.second_color;
                            border-width: 1px;
                            width: 300px;
                            height: 28px;
                            border-radius: 6px;
                            title_input:=TextInput {
                                //horizontal-alignment: TextHorizontalAlignment.center;
                                vertical-alignment: TextVerticalAlignment.center;
                                color: root.second_color;
                                //width: parent.width - 40px;
                                height: parent.height;
                                single-line: true;
                                wrap: TextWrap.word-wrap;
                                selection-background-color: root.selection_background_color;
                                accepted => {
                                    document_title_accepted(title_input.text);
                                    author_input.focus();
                                }
                            }
                        }

                    }
                    HorizontalLayout {
                        Text {
                            vertical-alignment: TextVerticalAlignment.center;
                            color: root.second_color;
                            text: "Author Title";
                            font-family: primary_font;
                            font-size: 14px;
                            width: 150px;
                        }
                        Rectangle {
                            border-color: root.second_color;
                            border-width: 1px;
                            width: 300px;
                            height: 28px;
                            border-radius: 6px;
                            author_input:=TextInput {
                                horizontal-alignment: TextHorizontalAlignment.center;
                                vertical-alignment: TextVerticalAlignment.center;
                                color: root.second_color;
                                width: parent.width - 40px;
                                height: parent.height;
                                selection-background-color: root.selection_background_color;
                                accepted => {
                                    document_author_accepted(author_input.text);
                                    location_input.focus();
                                }
                            }
                        }
                    }
                    HorizontalLayout {
                        Text {
                            vertical-alignment: TextVerticalAlignment.center;
                            color: root.second_color;
                            text: "Origin location";
                            font-family: primary_font;
                            font-size: 14px;
                            width: 150px;
                        }
                        Rectangle {
                            border-color: root.second_color;
                            border-width: 1px;
                            width: 300px;
                            height: 28px;
                            border-radius: 6px;
                            location_input:=TextInput {
                                horizontal-alignment: TextHorizontalAlignment.center;
                                vertical-alignment: TextVerticalAlignment.center;
                                color: root.second_color;
                                width: parent.width - 40px;
                                height: parent.height;
                                selection-background-color: root.selection_background_color;
                                accepted => {
                                    document_origin_location_accepted(location_input.text);
                                    window_popup.show();
                                }
                            }
                        }
                    }
                    HorizontalLayout {
                        Text {
                            vertical-alignment: TextVerticalAlignment.center;
                            color: root.second_color;
                            text: "Origin Date";
                            font-family: primary_font;
                            font-size: 14px;
                            width: 150px;
                        }
                        Rectangle {
                            window_popup:= PopupWindow {
                                close-policy: PopupClosePolicy.close-on-click-outside;
                                Rectangle {
                                    y: parent.y + 80px;
                                    background: root.background;
                                    width: 300px;
                                    height:  100px;
                                    border-width: 1px;
                                    border-color: root.second_color;
                                    border-radius: 6px;
                                    VerticalLayout {
                                        alignment: LayoutAlignment.center;
                                        height: parent.height;
                                        HorizontalLayout {
                                            width: parent.width;
                                            alignment: LayoutAlignment.center;
                                            spacing: 20px;
                                            Text {
                                                vertical-alignment: TextVerticalAlignment.center;
                                                color: root.second_color;
                                                text: "Datum";
                                                font-family: primary_font;
                                                font-size: 14px;
                                                width: 50px;
                                            }
                                            Rectangle {
                                                border-color: root.second_color;
                                                border-width: 1px;
                                                width: 120px;
                                                height: 28px;
                                                border-radius: 6px;
                                                calender_input:=TextInput {
                                                   horizontal-alignment: TextHorizontalAlignment.center;
                                                    vertical-alignment: TextVerticalAlignment.center;
                                                    color: root.second_color;
                                                    width: parent.width - 7px;
                                                    height: parent.height;
                                                    selection-background-color: root.selection_background_color;
                                                    accepted => {
                                                        document_origin_date_accepted(calender_input.text);
                                                        window_popup.close();
                                                        link_input.focus();
                                                    }
                                                }
                                                init => {
                                                    calender_input.focus();
                                                }
                                                TouchArea {
                                                    width: 100%;
                                                    height: 100%;
                                                    clicked => {
                                                        calender_input.focus();
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            border-color: root.second_color;
                            border-width: 1px;
                            width: 150px;
                            height: 28px;
                            border-radius: 6px;
                            Image {
                                source: @image-url("resources/clock.png");
                                width: 15px;
                                height: 15px;
                            }
                            TouchArea {
                                clicked => {
                                    window_popup.show();
                                }
                            }
                        }
                    }
                    HorizontalLayout {
                        links_text:= Text {
                            vertical-alignment: TextVerticalAlignment.center;
                            color: root.second_color;
                            text: "Document Links";
                            font-family: primary_font;
                            font-size: 14px;
                            width: 150px;
                        }
                        Rectangle {
                            border-color: root.second_color;
                            border-width: 1px;
                            width: 300px;
                            height: 28px;
                            border-radius: 6px;
                            link_input:=TextInput {
                                horizontal-alignment: TextHorizontalAlignment.center;
                                vertical-alignment: TextVerticalAlignment.center;
                                color: root.second_color;
                                width: parent.width - 40px;
                                height: parent.height;
                                selection-background-color: root.selection_background_color;
                                accepted => {
                                    document_links_accepted(link_input.text);
                                    tag_input.focus();
                                }
                            }
                        }

                    }
                    HorizontalLayout {
                        Text {
                            vertical-alignment: TextVerticalAlignment.center;
                            color: root.second_color;
                            text: "Document Tags";
                            font-family: primary_font;
                            font-size: 14px;
                            width: 150px;
                        }
                        Rectangle {
                            border-color: root.second_color;
                            border-width: 1px;
                            width: 300px;
                            height: 28px;
                            border-radius: 6px;
                            tag_input:=TextInput {
                                horizontal-alignment: TextHorizontalAlignment.center;
                                vertical-alignment: TextVerticalAlignment.center;
                                color: root.second_color;
                                width: parent.width - 40px;
                                height: parent.height;
                                selection-background-color: root.selection_background_color;
                                accepted => {
                                    document_tags_accepted(tag_input.text);
                                    info_text.text = title_input.text;
                                    info_text.width = title_input.text.character-count * 8px;
                                    info.visible = true;
                                    submit_formular();
                                }
                            }
                        }
                    }
                    info:= HorizontalLayout {
                    visible: true;
                    spacing: 0px;
                        Text {

                            font-size: 8px;
                            color: root.second_color;
                            font-family: root.primary_font;
                            width: 8px * 9;
                            text: "Dokument ";
                        }
                        info_text:=Text {
                            font-size: 8px;
                            color: root.accent_color;
                            font-family: root.primary_font;
                            width: 0px;
                        }
                        Text {
                            width: 8px * 40;
                            font-size: 8px;
                            color: root.second_color;
                            font-family: root.primary_font;
                            text: " wurde manuell eingereicht und registriert.";
                        }
                    }
                }
            }
        }
    }
}